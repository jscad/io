const test = require('ava')

const {CSG} = require('@jscad/csg')

const {serialize} = require('../index.js')
const {dxfHeaders, dxfClasses, dxfTables, dxfBlocks, dxfObjects} = require('../autocad_AC2017')

test('CSG to DXF 3DFACE', t => {
  const csg1 = new CSG()
  t.is(csg1.polygons.length,0)

  const obs1 = serialize(csg1)
  const exp1 = [empty]
  t.deepEqual(obs1,exp1)

  const csg2 = CSG.cube()
  t.is(csg2.polygons.length,6)

  const obs2 = serialize(csg2)
  const exp2 = [threeface1]
  t.deepEqual(obs2,exp2)
})

const empty = `999
DXF generated by JSCAD
${dxfHeaders({})}
${dxfClasses({})}
${dxfTables({})}
${dxfBlocks({})}
  0
SECTION
  2
ENTITIES
  0
ENDSEC
${dxfObjects({})}
EOF
`

const threeface1 = `999
DXF generated by JSCAD
${dxfHeaders({})}
${dxfClasses({})}
${dxfTables({})}
${dxfBlocks({})}
  0
SECTION
  2
ENTITIES
  0
3DFACE
  5
CAD00001
  100
AcDbEntity
  8
0
  100
AcDbFace
  70
0
  10
-1
  20
-1
  30
-1
  11
-1
  21
-1
  31
1
  12
-1
  22
1
  32
1
  13
-1
  23
1
  33
-1
  0
3DFACE
  5
CAD00002
  100
AcDbEntity
  8
0
  100
AcDbFace
  70
0
  10
1
  20
-1
  30
-1
  11
1
  21
1
  31
-1
  12
1
  22
1
  32
1
  13
1
  23
-1
  33
1
  0
3DFACE
  5
CAD00003
  100
AcDbEntity
  8
0
  100
AcDbFace
  70
0
  10
-1
  20
-1
  30
-1
  11
1
  21
-1
  31
-1
  12
1
  22
-1
  32
1
  13
-1
  23
-1
  33
1
  0
3DFACE
  5
CAD00004
  100
AcDbEntity
  8
0
  100
AcDbFace
  70
0
  10
-1
  20
1
  30
-1
  11
-1
  21
1
  31
1
  12
1
  22
1
  32
1
  13
1
  23
1
  33
-1
  0
3DFACE
  5
CAD00005
  100
AcDbEntity
  8
0
  100
AcDbFace
  70
0
  10
-1
  20
-1
  30
-1
  11
-1
  21
1
  31
-1
  12
1
  22
1
  32
-1
  13
1
  23
-1
  33
-1
  0
3DFACE
  5
CAD00006
  100
AcDbEntity
  8
0
  100
AcDbFace
  70
0
  10
-1
  20
-1
  30
1
  11
1
  21
-1
  31
1
  12
1
  22
1
  32
1
  13
-1
  23
1
  33
1
  0
ENDSEC
${dxfObjects({})}
EOF
`

const lwpolyline1 = `999
DXF generated by JSCAD
${dxfHeaders({})}
${dxfClasses({})}
${dxfTables({})}
${dxfBlocks({})}
  0
SECTION
  2
ENTITIES
  0
LWPOLYLINE
  5
CAD1
  100
AcDbEntity
  8
0
  67
0
  100
AcDbPolyline
  90
5
  70
1
  10
-1
  20
-1
  10
1
  20
-1
  10
1
  20
1
  10
-1
  20
1
  10
-1
  20
-1
  0
ENDSEC
${dxfObjects({})}
EOF
`

const lwpolylineByTwo = `999
DXF generated by JSCAD
${dxfHeaders({})}
${dxfClasses({})}
${dxfTables({})}
${dxfBlocks({})}
  0
SECTION
  2
ENTITIES
  0
LWPOLYLINE
  5
CAD0
  100
AcDbEntity
  8
0
  67
0
  100
AcDbPolyline
  90
5
  70
1
  10
-1
  20
-1
  10
1
  20
-1
  10
1
  20
1
  10
-1
  20
1
  10
-1
  20
-1
  0
LWPOLYLINE
  5
CAD1
  100
AcDbEntity
  8
0
  67
0
  100
AcDbPolyline
  90
5
  70
1
  10
-1
  20
-1
  10
1
  20
-1
  10
1
  20
1
  10
-1
  20
1
  10
-1
  20
-1
  0
ENDSEC
${dxfObjects({})}
EOF
`

const polyline1 = `999
DXF generated by JSCAD
${dxfHeaders({})}
${dxfClasses({})}
${dxfTables({})}
${dxfBlocks({})}
  0
SECTION
  2
ENTITIES
  0
POLYLINE
  5
CAD0
  100
AcDbEntity
  8
0
  100
AcDb2dPolyline
  0
VERTEX
  5
EEE00
  100
AcDbEntity
  8
0
  100
AcDbVertex
  100
AcDb2dVertex
 10
-1
 20
-1
  0
VERTEX
  5
EEE01
  100
AcDbEntity
  8
0
  100
AcDbVertex
  100
AcDb2dVertex
 10
1
 20
-1
  0
VERTEX
  5
EEE02
  100
AcDbEntity
  8
0
  100
AcDbVertex
  100
AcDb2dVertex
 10
1
 20
1
  0
VERTEX
  5
EEE03
  100
AcDbEntity
  8
0
  100
AcDbVertex
  100
AcDb2dVertex
 10
-1
 20
1
  0
VERTEX
  5
EEE04
  100
AcDbEntity
  8
0
  100
AcDbVertex
  100
AcDb2dVertex
 10
-1
 20
-1
  0
SEQEND
  5
CAE0
  100
AcDbEntity
  0
ENDSEC
${dxfObjects({})}
EOF
`

